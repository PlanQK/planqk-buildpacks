#!/usr/bin/env bash

# build: download vom serverless-repo, extract 'job-template' directory to "target directory", pip install von reqirements.txt

# Build script for planqk specific Buildpack
# Autuhor: Robert Brennenstuhl
# Version 0.1
# Created 16.01.2024

set -eo pipefail

echo "---> planqk Buildpack "



#1. Create the layer directory
serverless_template_layer="CNB_LAYERS_DIR/serverless_template"
mkdir -p "${serverless_template_layer}"

#2 pulling serverless template
echo "copy the serverless_template directory"
# serverles_template_url=https://gitlab.com/StoneOne/planqk/serverless-template
apt-get update
apt-get install -y git

git clone https://gitlab.com/StoneOne/planqk/serverless-template "$serverless_template_layer"

cd "$serverless_template_layer"


# copying the code into the directory is suspended for local testing.
# kopiere den user_code in das directory
# gehe in das user_code directory
cd user_code

#!/bin/bash

if [[ -f "requirements.txt" ]]; then
  echo "Installing Python packages from requirements.txt..."
  pip install -r requirements.txt
else
  echo "No requirements.txt found."
fi

# pip install
# setzte Entrypoint ENTRY_POINT=src.program:run
ENTRY_POINT=src.program:run
# setzte PYTHONPATH=../job-template python3 -m app
PYTHONPATH=../job-template python3 -m app
